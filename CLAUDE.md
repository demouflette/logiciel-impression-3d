# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Build & Run

- **Framework:** .NET Framework 4.8.1, Windows Forms (legacy MSBuild `.csproj`)
- **IDE:** Visual Studio 2022 Community
- **Build from CLI:** `msbuild "logiciel d'impression 3d.csproj" /p:Configuration=Release`
- **Installer:** Run `build_installer.bat` (requires Inno Setup 6 installed)
- **No test suite exists.**

## Language Convention

The entire codebase is in **French** — UI strings, variable names, method names, comments. All new code must follow this convention.

## Architecture

Single-process Windows Forms app for generating 3D printing quotes (devis). No third-party dependencies — only .NET BCL assemblies. JSON parsing is done manually (string indexing), not with a JSON library.

### Startup flow

```
Program.cs → UpdateManager.VerifierMiseAJour() → UserManager → LoginForm → Form1
```

### Key classes

| Class | File | Purpose |
|---|---|---|
| `Form1` + `DetailsCouts` | `Form1.cs` | Main window: manual quote calc + 3MF-based quote calc |
| `ThreeMFParser`, `ThreeMFFile`, `Object3D` | `ThreeMFParser.cs` | Parses 3MF (ZIP+XML), extracts geometry & Bambu Lab metadata |
| `UserManager` / `User` | `UserManager.cs`, `User.cs` | Auth system (SHA-256 hashed passwords), persists to `users.dat` |
| `ParametresImpressionForm`, `Bobine` | `ParametresImpression.cs` | Settings: electricity cost, AMS purge %, TVA, margin, spool catalog |
| `ImprimanteSpecsManager` | `ImprimanteSpecsManager.cs` | Downloads/caches printer power specs from GitHub |
| `UpdateManager` | `UpdateManager.cs` | Auto-update via GitHub Releases API (repo: `demouflette/logiciel-impression-3d`) |

### Data persistence

All data is stored in **pipe-delimited flat text files** (no database):
- `users.dat` — user accounts
- `parametres_impression.dat` — print settings + filament spool catalog
- `imprimantes_specs_cache.dat` — cached printer specs (7-day TTL)

### 3MF weight/time estimation

Weight and time are estimated from vertex count using empirically calibrated formulas:
- Weight: `vertices × 0.0000395 g/vertex`
- Time: `vertices × 0.000124 min/vertex`

## Important Rules

- **Do not manually edit `*.Designer.cs` files** — they are auto-generated by the Visual Studio Forms Designer.
- `UserManagerDuplicate.cs` is an empty leftover file and can be ignored.
- The project has **no NuGet packages**. `System.IO.Compression` is used for ZIP/3MF handling.
