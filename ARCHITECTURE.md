# ??? Architecture du Système de Mise à Jour

## Vue d'ensemble

```
???????????????????????????????????????????????????????????????????
?                    DÉVELOPPEUR                                   ?
?                                                                  ?
?  1. Code nouvelle fonctionnalité                                ?
?  2. Commit & Push                                               ?
?  3. Crée un tag (v1.0.1.0)                                      ?
???????????????????????????????????????????????????????????????????
                            ?
                            ?
???????????????????????????????????????????????????????????????????
?                    GITHUB REPOSITORY                             ?
?  https://github.com/VOTRE_NOM/logiciel-impression-3d            ?
?                                                                  ?
?  ??????????????????  ??????????????????  ????????????????????  ?
?  ?  Source Code   ?  ?  .github/      ?  ?   Releases       ?  ?
?  ?  - Form1.cs    ?  ?  workflows/    ?  ?  - v1.0.0.0      ?  ?
?  ?  - Program.cs  ?  ?  build.yml     ?  ?  - v1.0.1.0      ?  ?
?  ?  - *.cs        ?  ?                ?  ?  - v1.1.0.0      ?  ?
?  ??????????????????  ??????????????????  ????????????????????  ?
??????????????????????????????????????????????????????????????????
                                 ?
                   Tag créé ? Déclenche workflow
                                 ?
                                 ?
???????????????????????????????????????????????????????????????????
?                    GITHUB ACTIONS                                ?
?  Workflow: build-and-release.yml                                ?
?                                                                  ?
?  Étape 1: Extraction version du tag                            ?
?           ?? tag: v1.0.1.0 ? version: 1.0.1.0                  ?
?           ?? Mise à jour AssemblyInfo.cs                       ?
?                                                                  ?
?  Étape 2: Setup MSBuild                                        ?
?           ?? Installation de MSBuild                           ?
?                                                                  ?
?  Étape 3: Build du projet                                      ?
?           ?? Restore NuGet packages                            ?
?           ?? Compile en mode Release                           ?
?           ?? Génère: logiciel d'impression 3d.exe              ?
?                                                                  ?
?  Étape 4: Installation Inno Setup                              ?
?           ?? Télécharge et installe Inno Setup 6               ?
?                                                                  ?
?  Étape 5: Création de l'installateur                           ?
?           ?? Mise à jour setup_script.iss avec version         ?
?           ?? Compile avec Inno Setup                           ?
?           ?? Génère: Setup_1.0.1.0.exe                         ?
?                                                                  ?
?  Étape 6: Création fichier version.txt                         ?
?           ?? Contenu: 1.0.1.0                                  ?
?                                                                  ?
?  Étape 7: Création GitHub Release                              ?
?           ?? Tag: v1.0.1.0                                     ?
?           ?? Upload: Setup_1.0.1.0.exe                         ?
?           ?? Upload: logiciel-impression-3d.exe                ?
?           ?? Upload: version.txt                               ?
?                                                                  ?
?  ? BUILD TERMINÉ                                               ?
???????????????????????????????????????????????????????????????????
                             ?
                             ?
???????????????????????????????????????????????????????????????????
?                    GITHUB RELEASE                                ?
?  https://github.com/.../releases/tag/v1.0.1.0                   ?
?                                                                  ?
?  ?? Assets téléchargeables:                                     ?
?     ?? Logiciel_Impression_3D_Setup_1.0.1.0.exe (Installateur) ?
?     ?? logiciel-impression-3d.exe (Portable)                   ?
?     ?? version.txt (1.0.1.0)                                   ?
???????????????????????????????????????????????????????????????????
                             ?
                             ? API GitHub Releases
                             ? GET /repos/.../releases/latest
                             ?
                             ?
???????????????????????????????????????????????????????????????????
?                 APPLICATION CLIENT                               ?
?  logiciel d'impression 3d.exe (v1.0.0.0)                        ?
?                                                                  ?
?  Au démarrage:                                                  ?
?  1. UpdateManager.VerifierMiseAJour()                          ?
?  2. Appel API: releases/latest                                 ?
?  3. Comparaison: 1.0.0.0 vs 1.0.1.0                            ?
?  4. Détection: Nouvelle version disponible!                    ?
?                                                                  ?
?  ????????????????????????????????????????                      ?
?  ?  ?? Mise à jour disponible           ?                      ?
?  ?                                       ?                      ?
?  ?  Version actuelle : 1.0.0.0          ?                      ?
?  ?  Nouvelle version : 1.0.1.0          ?                      ?
?  ?                                       ?                      ?
?  ?  Télécharger?  [OUI]  [NON]          ?                      ?
?  ????????????????????????????????????????                      ?
?                                                                  ?
?  Si OUI:                                                        ?
?  5. Télécharge l'exécutable ou installateur                    ?
?  6. Lance le nouveau fichier                                   ?
?  7. Ferme l'ancienne version                                   ?
?                                                                  ?
?  ? MISE À JOUR TERMINÉE                                        ?
???????????????????????????????????????????????????????????????????
```

---

## Flux de données détaillé

### 1. Développement ? GitHub

```
Développeur
    ?
    ?? Modifie code
    ?
    ?? Update AssemblyInfo.cs
    ?  ?? [assembly: AssemblyVersion("1.0.1.0")]
    ?
    ?? git commit -m "Version 1.0.1.0"
    ?
    ?? git tag v1.0.1.0
    ?
    ?? git push origin v1.0.1.0
         ?
         ?
    GitHub Repository
```

### 2. GitHub ? GitHub Actions

```
GitHub détecte le tag
    ?
    ?? Lit: .github/workflows/build-and-release.yml
    ?
    ?? Déclenche: workflow "Build and Release"
    ?
    ?? Workflow s'exécute
         ?
         ?? Checkout code
         ?? Extract version from tag
         ?? Setup MSBuild
         ?? Build solution
         ?? Install Inno Setup
         ?? Build installer
         ?? Create version.txt
         ?? Create GitHub Release
         ?? Upload assets
```

### 3. GitHub Actions ? GitHub Release

```
Workflow terminé
    ?
    ?? Crée une nouvelle Release
    ?  ?? Tag: v1.0.1.0
    ?
    ?? Upload fichiers
    ?  ?? Setup_1.0.1.0.exe
    ?  ?? logiciel-impression-3d.exe
    ?  ?? version.txt
    ?
    ?? Release publiée et visible
```

### 4. Application ? GitHub Release

```
Application démarre
    ?
    ?? UpdateManager.VerifierMiseAJour()
    ?
    ?? WebClient appel:
    ?  GET https://api.github.com/repos/USER/REPO/releases/latest
    ?
    ?? Parse JSON response:
    ?  {
    ?    "tag_name": "v1.0.1.0",
    ?    "assets": [
    ?      {
    ?        "name": "logiciel-impression-3d.exe",
    ?        "browser_download_url": "https://github.com/..."
    ?      }
    ?    ]
    ?  }
    ?
    ?? Compare versions:
    ?  1.0.0.0 (locale) < 1.0.1.0 (distante)
    ?
    ?? Affiche notification
    ?
    ?? Si accepté:
       ?? Télécharge depuis browser_download_url
       ?? Enregistre dans %TEMP%
       ?? Lance nouveau fichier
       ?? Ferme ancienne version
```

---

## Composants clés

### UpdateManager.cs

```csharp
public class UpdateManager
{
    // Configuration
    private const string GithubOwner = "VOTRE_NOM";
    private const string GithubRepo = "logiciel-impression-3d";
    
    // Méthodes principales
    ?? VerifierMiseAJour()           // Point d'entrée
    ?? ObtenirDerniereRelease()      // Appel API GitHub
    ?? ExtraireValeurJson()           // Parse JSON simple
    ?? TrouverUrlAsset()              // Trouve l'URL de téléchargement
    ?? TelechargerMiseAJour()         // Télécharge et installe
}
```

### Workflow GitHub Actions

```yaml
.github/workflows/build-and-release.yml

trigger: push tags v*.*.*.*

jobs:
  build-and-release:
    steps:
      ?? Checkout code
      ?? Extract version
      ?? Update AssemblyInfo
      ?? Setup MSBuild
      ?? Restore NuGet
      ?? Build solution
      ?? Install Inno Setup
      ?? Update ISS script
      ?? Build installer
      ?? Create version.txt
      ?? Create GitHub Release
      ?? Upload assets (x3)
```

---

## Sécurité et bonnes pratiques

### ? Sécurisé

- Utilise HTTPS pour tous les téléchargements
- Vérifie les versions avec Version.CompareTo()
- GitHub Releases hébergés sur infrastructure GitHub
- Pas de serveur tiers requis
- Authentification GitHub via tokens

### ?? À noter

- Rate limit GitHub API : 60 requêtes/heure (non authentifié)
- Releases publiques accessibles sans authentification
- Téléchargements depuis domaine github.com

---

## Évolution possible

### Court terme
- [ ] Signature numérique des exécutables
- [ ] Vérification checksum après téléchargement
- [ ] Support des pre-releases (beta)
- [ ] Historique des versions dans l'app

### Moyen terme
- [ ] Auto-update silencieux (sans redémarrage)
- [ ] Rollback vers version précédente
- [ ] Delta updates (télécharger uniquement les changements)
- [ ] Analytics de déploiement

### Long terme
- [ ] Multi-plateforme (cross-platform updates)
- [ ] CDN pour accélérer les téléchargements
- [ ] A/B testing de versions
- [ ] Staged rollout (déploiement progressif)

---

## Métriques et monitoring

### Données trackables

```
GitHub Releases
    ?? Nombre de téléchargements par release
    ?? Date de publication
    ?? Taille des assets

GitHub Actions
    ?? Durée de build
    ?? Taux de succès/échec
    ?? Logs détaillés

Application (à implémenter)
    ?? Taux d'adoption des mises à jour
    ?? Erreurs de téléchargement
    ?? Versions utilisées
```

---

**Document créé le** : 2024  
**Version** : 1.0  
**Auteur** : Configuration système de mise à jour automatique
